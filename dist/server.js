(()=>{var e={532:(e,n,t)=>{function r(e,n,t,r,s,o,i){try{var a=e[o](i),c=a.value}catch(e){return void t(e)}a.done?n(c):Promise.resolve(c).then(r,s)}function s(e){return function(){var n=this,t=arguments;return new Promise((function(s,o){var i=e.apply(n,t);function a(e){r(i,s,o,a,c,"next",e)}function c(e){r(i,s,o,a,c,"throw",e)}a(void 0)}))}}var{Client:o,Pool:i}=t(723),a=t(101);e.exports=class{constructor(){this.connected=!1,this.client=new o({user:a.user,password:a.password,database:a.database,host:a.host,port:a.port}),this.client.on("disconnect",(function(e){this.connected=!1,console.log("client disconnected")})),this.client.on("connect",(function(e){this.connected=!0,console.log("client connected")}))}all(e){var n=arguments,t=this;return s((function*(){var r=n.length>1&&void 0!==n[1]?n[1]:[];return yield t.reconnect(),yield t.client.query(e,r)}))()}get(e){var n=arguments,t=this;return s((function*(){var r=n.length>1&&void 0!==n[1]?n[1]:[];return yield t.reconnect(),yield t.client.query(e,r)}))()}reconnect(){var e=this;return s((function*(){e.connected||(e.connected=!0,yield e.client.connect())}))()}}},101:e=>{e.exports={host:"postgresql-62266-0.cloudclusters.net",port:11156,database:"Folk",user:"admin",password:"FolkappPass2021."}},981:e=>{e.exports=class{constructor(e,n,t){this.id=e,this.name=n,this.artistType=t}}},79:(e,n,t)=>{var r=t(981),s=t(819);e.exports=class{constructor(e){this.dao=e}ensembles(){return this.dao.all('SELECT * FROM "Ensembles" WHERE "ArtistType" = $1',[1]).then((e=>{var{rows:n}=e;return n.map((e=>new r(e.Id,e.Name,e.ArtistType)))})).catch(console.log)}oldRecordings(){return this.dao.all('SELECT * FROM "Ensembles" WHERE "ArtistType" = $1',[2]).then((e=>{var{rows:n}=e;return n.map((e=>new r(e.Id,e.Name,e.ArtistType)))})).catch(console.log)}songsByEnsembleId(e){return this.dao.all('SELECT * FROM "Songs" WHERE "EnsembleId" = $1 and "SongType" = $2',[e,0]).then((e=>{var{rows:n}=e;return n.map((e=>new s(e.Id,e.Title,e.SongType,e.EnsembleId)))})).catch(console.log)}chantsByEnsembleId(e){return this.dao.all('SELECT * FROM "Songs" WHERE "EnsembleId" = $1 and "SongType" = $2',[e,1]).then((e=>{var{rows:n}=e;return n.map((e=>new s(e.Id,e.Title,e.SongType,e.EnsembleId)))})).catch(console.log)}songById(e){return this.dao.get('SELECT * FROM "Songs" WHERE "Id" = $1',[e]).then((e=>{var{rows:n}=e,t=n[0];return new s(t.Id,t.Title,t.SongType,t.EnsembleId,t.Path)})).catch(console.log)}}},661:(e,n,t)=>{function r(e,n,t,r,s,o,i){try{var a=e[o](i),c=a.value}catch(e){return void t(e)}a.done?n(c):Promise.resolve(c).then(r,s)}function s(e){return function(){var n=this,t=arguments;return new Promise((function(s,o){var i=e.apply(n,t);function a(e){r(i,s,o,a,c,"next",e)}function c(e){r(i,s,o,a,c,"throw",e)}a(void 0)}))}}var o=t(127).Router(),i=t(532),a=new(t(79))(new i);o.get("/ensembles",function(){var e=s((function*(e,n){var t=yield a.ensembles();n.send(t)}));return function(n,t){return e.apply(this,arguments)}}()),o.get("/old-recording",function(){var e=s((function*(e,n){var t=yield a.oldRecordings();n.send(t)}));return function(n,t){return e.apply(this,arguments)}}()),o.get("/songs/:id",function(){var e=s((function*(e,n){var t=e.params.id,r=yield a.songsByEnsembleId(t),s=yield a.chantsByEnsembleId(t);n.send({songs:r,chants:s})}));return function(n,t){return e.apply(this,arguments)}}()),o.get("/song/:id",function(){var e=s((function*(e,n){var t=e.params.id,r=yield a.songById(t);null==r&&n.status(404).send("Not found"),n.send(r)}));return function(n,t){return e.apply(this,arguments)}}()),o.get("/songdata/:id",function(){var e=s((function*(e,n){var t=e.params.id,r=yield a.songData(t);null==r&&n.status(404).send("Not found");var s=Buffer.from(r.Data).toString("base64");n.json({file:s})}));return function(n,t){return e.apply(this,arguments)}}()),e.exports=o},819:e=>{e.exports=class{constructor(e,n,t,r,s){this.id=e,this.name=n,this.songType=t,this.ensembleId=r,this.path=s}}},752:(e,n,t)=>{var r=t(960),s=t(127),o=t(622),i=t(358),a=t(150),c=t(661),{env:u}=t(765),l=s();l.use(a("dev")),l.use(s.json()),l.use(s.urlencoded({extended:!1})),l.use(i()),l.use(s.static(o.join(__dirname,"public"))),l.use("/folkapi",c),l.use((function(e,n,t){t(r(404))})),l.use((function(e,n,t,r){t.locals.message=e.message,t.locals.error="development"===n.app.get("env")?e:{},t.status(e.status||500),t.render("error")}));var d=process.env.PORT||3e3;l.listen(d,(()=>{console.log("listening on ofalaaa ".concat(u.PORT))})),e.exports=l},358:e=>{"use strict";e.exports=require("cookie-parser")},127:e=>{"use strict";e.exports=require("express")},960:e=>{"use strict";e.exports=require("http-errors")},150:e=>{"use strict";e.exports=require("morgan")},622:e=>{"use strict";e.exports=require("path")},723:e=>{"use strict";e.exports=require("pg")},765:e=>{"use strict";e.exports=require("process")}},n={};!function t(r){if(n[r])return n[r].exports;var s=n[r]={exports:{}};return e[r](s,s.exports,t),s.exports}(752)})();